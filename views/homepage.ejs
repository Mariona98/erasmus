<!-- Include header dynamically -->

<%- include('partials/header.ejs') %>

<!-- Filter/Search Section -->
<div id="filterswrapper" class="search-filter dropdown m-auto">
  <label for="country">Country:</label>
  <select id="country" class="form-select" aria-label="Country select">
    <option value="" selected disabled>Select a country</option>
    <option value="Austria">Austria</option>
    <option value="Belgium">Belgium</option>
    <option value="Bulgaria">Bulgaria</option>
    <option value="Croatia">Croatia</option>
    <option value="Cyprus">Cyprus</option>
    <option value="Czech Republic">Czech Republic</option>
    <option value="Denmark">Denmark</option>
    <option value="Estonia">Estonia</option>
    <option value="Finland">Finland</option>
    <option value="France">France</option>
    <option value="Germany">Germany</option>
    <option value="Greece">Greece</option>
    <option value="Hungary">Hungary</option>
    <option value="Ireland">Ireland</option>
    <option value="Italy">Italy</option>
    <option value="Latvia">Latvia</option>
    <option value="Lithuania">Lithuania</option>
    <option value="Luxembourg">Luxembourg</option>
    <option value="Malta">Malta</option>
    <option value="Netherlands">Netherlands</option>
    <option value="Poland">Poland</option>
    <option value="Portugal">Portugal</option>
    <option value="Romania">Romania</option>
    <option value="Slovakia">Slovakia</option>
    <option value="Slovenia">Slovenia</option>
    <option value="Spain">Spain</option>
    <option value="Sweden">Sweden</option>
    <option value="Other">Other</option>
  </select>

  <label for="month" class="mt-3">Month:</label>
  <select id="month" class="form-select mt-2">
    <option value="" selected disabled>Select a month</option>
    <option value="01">January</option>
    <option value="02">February</option>
    <option value="03">March</option>
    <option value="04">April</option>
    <option value="05">May</option>
    <option value="06">June</option>
    <option value="07">July</option>
    <option value="08">August</option>
    <option value="09">September</option>
    <option value="10">October</option>
    <option value="11">November</option>
    <option value="12">December</option>
  </select>

  <label for="days" class="mt-3">Number of Days:</label>
  <select id="days" class="form-select mt-2">
    <option value="" selected disabled>Select number of days</option>
    <% for (let i = 1; i <= 20; i++) { %>
      <option value="<%= i %>"><%= i %> day<%= i > 1 ? 's' : '' %></option>
    <% } %>
  </select>

  <button id="searchBtn" type="button" class="btn btn-primary mt-3">Search</button>
</div>

<div class="listingwrapper">
  <div class="background"></div>
  <!-- Listing Section -->
  <div class="listing">
  
    <div class="container">
      <div class="row">

        <center><h3 class="p-4">Posts</h3></center>
        <% entries.forEach((entry, index) => { %> 
          <% 
            // Calculate the number of days for the current entry
            const totalDays = Math.ceil((new Date(entry.end_date) - new Date(entry.entry_date)) / (1000 * 60 * 60 * 24)); 
            
          %>
        
          <% if (index > -1 ) { %> 
            <div class="col-sm col-4 mt-6">
              <div class="card">
                <!-- Wrap the card with an anchor tag to make it clickable -->
                <a href="/post/<%= entry.id %>" class="card-link" style="text-decoration: none; color: inherit;">
                  <div class="card-image">
                    <img src="/images/<%= entry.id %>" alt="Article Image" />
                  </div>
                  <div class="card-content">
                    <!-- Title in bold -->
                    <h5 class="card-heading" style="font-weight: bold;"><%= entry.title %></h5>
                
                    <!-- Country -->
                    <p class="card-subheading" style="margin: 0;">
                      <strong>Country:</strong> <%= entry.country %>
                    </p>
                
                    <!-- Age limits -->
                    <p class="card-subheading" style="margin: 0;">
                      <strong>Ages:</strong> <%= entry.age_limit_down || "N/A" %> - <%= entry.age_limit_up || "N/A" %>
                    </p>
                
                    <!-- Dates -->
                    <p class="card-subheading" style="margin: 0;">
                      <strong>Dates:</strong>
                      <%= new Date(entry.entry_date).toLocaleDateString('en-GB') %> to 
                      <%= new Date(entry.end_date).toLocaleDateString('en-GB') %>
                      <!-- Calculate and display the days -->
                      <span style="margin-left: 10px; font-size: 0.8em; opacity: 0.6;">
                        (<%= totalDays %> days)
                      </span>
                    </p>
                  </div>
                </a>
              </div>
            </div>
          <% } %> <!-- End of if statement -->
        <% }); %> <!-- End of forEach loop -->
        
        <div class="d-flex justify-content-end">
          <a class="text-white btn btn-primary" href="/posts">More</a>
        </div>
      </div>
      
      
    </div>
  </div>
</div>
<script>
document.getElementById("searchBtn").addEventListener("click", () => {
  const country = document.getElementById("country").value;
  const month = document.getElementById("month").value;
  const days = document.getElementById("days").value;

  let query = "?";
  if (country) query += `country=${country}&`;
  if (month) query += `month=${month}&`;
  if (days) query += `days=${days}&`;

  // Redirect to filtered results
  window.location.href = "/" + query.slice(0, -1); // Remove trailing '&'
});


</script>
<!-- Repeat more cards as needed -->
<%- include('partials/footer.ejs') %>

